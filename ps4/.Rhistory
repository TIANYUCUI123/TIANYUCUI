dataPanel <- pdata.frame(data, index=c("PERSONID"))
#####start the ols regression model####
data<-Koop_Tobias
View(data)
set.seed(1)
data<-Koop_Tobias
pid<-unique(data$PERSONID)
View(pid)
v<-sample(pid,100)
length(unique(v))
data4<-data[data$PERSONID%in%v,]
View(data4)
fepar<-rep(0,100)
ols_func <- function (beta,y=y,x1=x1,x2=x2) {
fepar<-beta[1:100]
beta1<-beta[101]
beta2<-beta[102]
s<-beta[103]
index<-d$Freq
alpha<-rep(fepar,index)
v<- (y-alpha-beta1*x1-beta2*x2)/ s
p<-dnorm(v)
lg<-log(p)
loglsum<-sum(lg)
return(-loglsum)
}  # finish the loglikelihood#
beta[1:102]<- rnorm(102)
beta[103]<-1
y<-data4$LOGWAGE
x1<-data4$EDUC
x2<-data4$POTEXPER
ols_func(beta,y,x1,x2)
optimLogit <- optim(beta,ols_func,y,x1,x2)
parameter<-optimLogit$par
set.seed(1)
data<-Koop_Tobias
pid<-unique(data$PERSONID)
View(pid)
v<-sample(pid,100)
length(unique(v))
data4<-data[data$PERSONID%in%v,]
set.seed(1)
data<-Koop_Tobias
pid<-unique(data$PERSONID)
View(pid)
v<-sample(pid,100)
length(unique(v))
data4<-data[data$PERSONID%in%v,]
View(data4)
fepar<-rep(0,100)
optim(beta,ols_func,y=y1,x1=x1,x2=x2)
optim(beta,ols_func,y=y,x1=x1,x2=x2)
reg<-lm(y~x1+x2+factor(data4$PERSONID))
coefficient<-reg$coefficients
View(coefficient)
#####start the ols regression model####
reg<-lm(y~x1+x2+factor(data4$PERSONID)-1)
View(coefficient)
coefficient<-reg$coefficients
View(coefficient)
coefficient[3:102]
ife<-coefficient[3:102]
View(ife)
seq(1:100)
index<-seq(1:100)
cbind(ife,index)
View(data4)
ability<-unique(data4$ABILITY)
View(abii)
View(ability)
data4new<-data4[!duplicated(data4$PERSONID),]
View(data4new)
names(data4new)
reg2<-lm(ynew~ABILITY+MOTHERED+FATHERED+BRKNHOME+SIBLINGS)
ynew<-coefficient[3:102]
reg2<-lm(ynew~ABILITY+MOTHERED+FATHERED+BRKNHOME+SIBLINGS)
data4new<-data4[!duplicated(data4$PERSONID),]
reg2<-lm(ynew~ABILITY+MOTHERED+FATHERED+BRKNHOME+SIBLINGS,data = data4new)
coefficientnew<-reg2$coefficients
print(coefficientnew)
Koop_Tobias <- read_excel("C:/Users/cuiti/Master Study/Second Semester/econometrics/TIANYUCUI/ps4/Koop-Tobias.xlsx")
View(Koop_Tobias)# use import command to import the data
data<-Koop_Tobias#change the data name
install.packages("plm")
pid<-unique(data$PERSONID)
v<-sample(pid,5)
print(v)
x<-dataorder[dataorder$PERSONID%in%v,]
View(x)
# clear console#
cat("\014")
# clear workspace#
rm(list=ls())
#install the bayesm package
install.packages("bayesm")
#start the package
library(bayesm)
# clear console#
cat("\014")
# clear workspace#
rm(list=ls())
set.seed(1)
library(readxl)
Koop_Tobias <- read_excel("C:/Users/cuiti/Master Study/Second Semester/econometrics/TIANYUCUI/ps4/Koop-Tobias.xlsx")
data<-Koop_Tobias#change the data name
pid<-unique(data$PERSONID)
v<-sample(pid,5)
print(v)
x<-dataorder[dataorder$PERSONID%in%v,]
View(x)
pid<-unique(data$PERSONID)
v<-sample(pid,5)
print(v)
x<-data[data$PERSONID%in%v,]
View(x)
#exercise 1 : importiing data#
# clear console#
cat("\014")
# clear workspace#
rm(list=ls())
set.seed(1)
library(readxl)
Koop_Tobias <- read_excel("C:/Users/cuiti/Master Study/Second Semester/econometrics/TIANYUCUI/ps4/Koop-Tobias.xlsx")
View(Koop_Tobias)# use import command to import the data
install.packages("plm")
#library(plm)
dataPanel <- pdata.frame(data, index=c("PERSONID"))
#library(plm)
dataPanel <- plm.data(data, index=c("PERSONID"))
library(plm)
dataPanel <- plm.data(data, index=c("PERSONID"))
dataPanel <- pdata.frame(data, index=c("PERSONID"))
View(data)
data<-Koop_Tobias#change the data name
View(data)
dataPanel <- pdata.frame(data, index=c("PERSONID"))
#exercise 1 : importiing data#
# clear console#
cat("\014")
# clear workspace#
rm(list=ls())
set.seed(1)
library(readxl)
Koop_Tobias <- read_excel("C:/Users/cuiti/Master Study/Second Semester/econometrics/TIANYUCUI/ps4/Koop-Tobias.xlsx")
View(Koop_Tobias)# use import command to import the data
data<-Koop_Tobias#change the data name
install.packages("plm")
install.packages("plm")
library(plm)
dataPanel <- pdata.frame(data, index=c("PERSONID"))
#View(dataPanel)
frequency(data$PERSONID)
freq<-as.data.frame(table(data$PERSONID))
View(freq)
names(freq)[1]<-"PERSONID"
pid<-unique(data$PERSONID)
View(pid)
v<-sample(pid,5)
print(v)
x<-dataorder[dataorder$PERSONID%in%v,]
x<-data[data$PERSONID%in%v,]
View(x)
x<-data[data$PERSONID%in%v,"LOGWAGE", "EDUC","POTEXPER"]
x<-data[data$PERSONID%in%v,"LOGWAGE" "EDUC" "POTEXPER"]
x<-data[data$PERSONID%in%v,C("LOGWAGE" ,"EDUC" ,"POTEXPER")]
x<-data[data$PERSONID%in%v, 2:4]
View(x)
x<-data[data$PERSONID%in%v, 1:4]
View(x)
print(v)
x<-data[data$PERSONID%in%v, 1:4]
View(x)
#find 5 individuals and their matched information#
x<-data[data$PERSONID%in%pid, 1:4]
#the table list of frequency for each individual, which represent the time
pid<-sample(unique(data$PERSONID),5)
#find 5 individuals and their matched information#
x<-data[data$PERSONID%in%pid, 1:4]
View(x)
model<- glm(LOGWAGE~EDUC+POTEXPER, data = data)
gls<- model$coefficients
modelcheck<- plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "random")#since I already manipulate data in exercise 1, I can just input the data#
plm<- modelcheck$coefficients
coef_result<- rbind(gls,plm)
coef_result
#exercise 3 fixed effect model#
dataorder<-data[order(data$PERSONID),]
choice<-c("PERSONID", "LOGWAGE", "EDUC","POTEXPER")
dataorder <- dataorder[choice]
#within estimation#
LOGWAGEMEAN<- aggregate(dataorder[,2],list(dataorder$PERSONID),mean)
EDUCMEAN<-aggregate(dataorder[, 3], list(dataorder$PERSONID), mean)
POTEXPERMEAN<-aggregate(dataorder[,4],list(dataorder$PERSONID),mean)
MEAN<-cbind(LOGWAGEMEAN,EDUCMEAN,POTEXPERMEAN)
names(MEAN) <- c("PERSONID", "LOGWAGEMEAN","DROP1","EDUCMEAN","DROP2","POTEXPERMEAN")
mean<-subset(MEAN,select = c(PERSONID,LOGWAGEMEAN,EDUCMEAN,POTEXPERMEAN))
View(mean)
View(LOGWAGEMEAN)
# mean of potential experience for each indivdiual#
MEAN<-cbind(LOGWAGEMEAN,EDUCMEAN,POTEXPERMEAN)
head(Mean)
head
head(MEAN)
names(MEAN) <- c("PERSONID", "LOGWAGEMEAN","DROP1","EDUCMEAN","DROP2","POTEXPERMEAN")
mean<-subset(MEAN,select = c(PERSONID,LOGWAGEMEAN,EDUCMEAN,POTEXPERMEAN))
# We finish arrange the mean of each needed variable#
withindata<-merge(mean,dataorder,by="PERSONID")# arrange the data that help to make estimation#
View(withindata)
n<-nrow(withindata)
regdata<-matrix(0,nrow=n,ncol=4)
for ( i in 2:4) {
regdata[,i]=withindata[,i+3]-withindata[,i]
}
head(regdata)
#Since the first column is personid difference, which will be zero, so we can rule out the first column#
colnames(regdata)<-c("withinwage","withineduc","withinpotexp")
#Since the first column is personid difference, which will be zero, so we can rule out the first column#
colnames(regdata)<-c("withinwage","withineduc","withinpotexp")
regdata<-data.frame(regdata[,-1])
#Since the first column is personid difference, which will be zero, so we can rule out the first column#
colnames(regdata)<-c("withinwage","withineduc","withinpotexp")
reg1<-lm(withinwage~withineduc+withinpotexp,data = regdata)
withincoefficient<- reg1$coefficients[2:3]
modelcheck2<- plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "within")
modelcoefficient<-modelcheck2$coefficients
result1<-rbind(withincoefficient,modelcoefficient)
print(result1)
#Between estimation#
reg2<-lm(LOGWAGEMEAN~EDUCMEAN+POTEXPERMEAN,data=mean)
betweencoefficient<-reg2$coefficients
modelcheck3<-plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "between")
modelcoefficient<-modelcheck3$coefficients
result2<-rbind(betweencoefficient,modelcoefficient)
print(result2)
#first difference estimation#
dataorder<-data[order(data$PERSONID),]
choice<-c("PERSONID", "LOGWAGE", "EDUC","POTEXPER")
dataorder <- as.matrix(dataorder[choice])
n<-nrow(dataorder)
#reupdate the database to help do the regression#
n<-nrow(dataorder)
m<-length(freq)
v<-matrix(0,nrow=n,ncol=ncol(dataorder))
for(i in 2:nrow(dataorder)){
v[i,]<- dataorder[i,] - dataorder[i-1,]
}
colnames(v)<-c("PERSONID","WAGE","EDUC","POTEXP")
v<-data.frame(v)
v<-v[ which( ! v$PERSONID ==1) , ]
v <- v[-1,]
reg3<-lm(WAGE~EDUC+POTEXP,data = v)
fdcoefficient<- reg3$coefficients
modelcheck4<-plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "fd")
modelcoefficient<-modelcheck4$coefficients
result3<-rbind(fdcoefficient,modelcoefficient)
print(result3)
############another method that use  the diff function#######################################
diffwage <- unlist(by(dataorder$LOGWAGE , list(dataorder$PERSONID) , function(i) c(NA,diff(i))))
diffwage<- na.omit(diffwage)
diffedu <- unlist(by(dataorder$EDUC , list(dataorder$PERSONID) , function(i) c(NA,diff(i))))
diffedu<- na.omit(diffedu)
diffpotexper<-- unlist(by(dataorder$POTEXPER , list(dataorder$PERSONID) , function(i) c(NA,diff(i))))
############another method that use  the diff function#######################################
diffwage <- unlist(by(dataorder$LOGWAGE , list(dataorder$PERSONID) , function(i) c(NA,diff(i))))
#generate a new database to help do the regression#
for(i in 2:nrow(dataorder)){
v[i,]<- dataorder[i,] - dataorder[i-1,]
}
head(v)
View(v)
dataorder<-data[order(data$PERSONID),]
choice<-c("PERSONID", "LOGWAGE", "EDUC","POTEXPER")
dataorder <- as.matrix(dataorder[choice])
#reupdate the database to help do the regression#
n<-nrow(dataorder)
m<-length(freq)
v<-matrix(0,nrow=n,ncol=ncol(dataorder))
for(i in 2:nrow(dataorder)){
v[i,]<- dataorder[i,] - dataorder[i-1,]
}
#first difference data#
#first difference data#
colnames(v)<-c("PERSONID","WAGE","EDUC","POTEXP")
View(v)
v<-v[ which( ! v$PERSONID ==1) , ]
v<-data.frame(v)
v<-v[ which( ! v$PERSONID ==1) , ]
View(v)
#for those personid difference that is not zero, we should eliminate since it represent the first difference of initial role of each individual#
v <- v[-1,]
reg3<-lm(WAGE~EDUC+POTEXP,data = v)
nrow(v)
nrow(dataorder)-nrow(pid)
nrow(dataorder)-nrow(unique(data$PERSONID))
nrow(dataorder)-nrow(unique(data$PERSONID))
nrow(dataorder)
nrow(unique(data$PERSONID))
length(unique(data$PERSONID))
nrow(dataorder)-length(unique(data$PERSONID))
print(nrow(dataorder))
print(nrow(dataorder)-length(unique(data$PERSONID)))
print(nrow(v))
print(nrow(dataorder)-length(unique(data$PERSONID)))
#check whether this method to do the arrangement is valid or not#
reg3<-lm(WAGE~EDUC+POTEXP,data = v)
fdcoefficient<- reg3$coefficients
modelcheck4<-plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "fd")
modelcoefficient<-modelcheck4$coefficients
result3<-rbind(fdcoefficient,modelcoefficient)
print(result3)
############another method that use  the diff function#######################################
diffwage <- unlist(by(dataorder$LOGWAGE , list(dataorder$PERSONID) , function(i) c(NA,diff(i))))
############another method that use  the diff function#######################################
dataorder<-data.frame(dataorder)
diffwage <- unlist(by(dataorder$LOGWAGE , list(dataorder$PERSONID) , function(i) c(NA,diff(i))))
View(diffwage)
diffwage<- na.omit(diffwage)
diffedu <- unlist(by(dataorder$EDUC , list(dataorder$PERSONID) , function(i) c(NA,diff(i))))
diffedu<- na.omit(diffedu)
diffpotexper<-- unlist(by(dataorder$POTEXPER , list(dataorder$PERSONID) , function(i) c(NA,diff(i))))
diffpotexper<- na.omit(diffpotexper)
reg4<-lm(diffwage~diffedu+diffpotexper)
fdcoefficient<- reg3$coefficients
View(fdcoefficient)
print(fdcoefficient)
modelcheck4<-plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "fd")
modelcoefficient<-modelcheck4$coefficients
result4<-rbind(fdcoefficient,modelcoefficient)
print(result4)
#exercise 4 understanding fixed effects
set.seed(1)
data<-Koop_Tobias
pid<-unique(data$PERSONID)
v<-sample(pid,100)
length(unique(v))
data4<-data[data$PERSONID%in%v,]
pid<-sample(unique(data$PERSONID),100)
length(pid)
data4<-data[data$PERSONID%in%pid,]
# sample for 100 individual information#
head(data4)
#generate a vector for individual fixed effect#
ols_func <- function (beta,y=y,x1=x1,x2=x2) {
fepar<-beta[1:100]
beta1<-beta[101]
beta2<-beta[102]
s<-beta[103]
index<-d$Freq
alpha<-rep(fepar,index)
v<- (y-alpha-beta1*x1-beta2*x2)/ s
p<-dnorm(v)
lg<-log(p)
loglsum<-sum(lg)
return(-loglsum)
}  # finish the loglikelihood#
index<-d$Freq
freq<-as.data.frame(table(data$PERSONID))
index<-freq
alpha<-rep(fepar,index)
# sample for 100 individual information#
ols_func <- function (beta,y=y,x1=x1,x2=x2) {
fepar<-beta[1:100]#fixed effect parameter#
beta1<-beta[101]#education coefficient#
beta2<-beta[102]#potential experience coefficient#
s<-beta[103]# standard error#
index<-freq
alpha<-rep(fepar,index)
v<- (y-alpha-beta1*x1-beta2*x2)/ s
p<-dnorm(v)
lg<-log(p)
loglsum<-sum(lg)
return(-loglsum)
}  # finish the loglikelihood#
fepar<-beta[1:100]#fixed effect parameter#
# sample for 100 individual information#
beta<-rep(0,103)
fepar<-beta[1:100]#fixed effect parameter#
beta1<-beta[101]#education coefficient#
beta2<-beta[102]#potential experience coefficient#
s<-beta[103]# standard error#
index<-freq
alpha<-rep(fepar,index)
freq<-table(data$PERSONID)
index<-freq
alpha<-rep(fepar,index)
v<- (y-alpha-beta1*x1-beta2*x2)/ s
freq<-as.vector(table(data$PERSONID))
index<-freq
alpha<-rep(fepar,index)
freq<-as.data.frame(table(data$PERSONID))
index<-freq
alpha<-rep(fepar,index)
freq<-as.matrix.data.frame(table(data$PERSONID))
dataPanel <- pdata.frame(data, index=c("PERSONID"))
freq<-as.matrix.data.frame(table(data$PERSONID))
freq<-as.matrix(table(data$PERSONID))
index<-freq
alpha<-rep(fepar,index)
View(freq)
#the table list of frequency for each individual, which represent the time
pid<-sample(unique(data$PERSONID),5)
names(freq)[1]<-"PERSONID"
View(freq)
colnames(freq)[1]<-"PERSONID"
View(freq)
colnames(freq)<-c("PERSONID","Freq")
vIEW(freq)
View(freq)
class(freq)
freq<-table(data$PERSONID)
class(freq)
freq<-as.vector(table(data$PERSONID))
class(freq)
class(freq)
index<-freq
alpha<-rep(fepar,index)
View(index)
unique(index)
index<-na.omit(index)
length(index)
# sample for 100 individual information#
beta<-rep(0.1,103)
alpha<-rep(fepar,index)
index<-as.data.frame(freq)
alpha<-rep(fepar,index)
# sample for 100 individual information#
beta<-rep(0.1,103)
fepar<-beta[1:100]#fixed effect parameter#
beta1<-beta[101]#education coefficient#
beta2<-beta[102]#potential experience coefficient#
s<-beta[103]# standard error#
index<-as.data.frame(freq)
alpha<-rep(fepar,index)
index<-as.numeric(freq)
alpha<-rep(fepar,index)
alpha<-rep(fepar,each=index)
View(alpha)
View(data4)
freq<-freqdata4$PERSONID
freq<-freq(data4$PERSONID)
freq<-table(data4$PERSONID)
View(freq)
freq<-table(data4$PERSONID)
freq<-as.data.frame(table(data4$PERSONID))
sum(freq)
sum(freq)
freq<-table(data4$PERSONID)
sum(freq)
index<-as.numeric(freq)
alpha<-rep(fepar,each=index)
View(alpha)
freq<-table(data4$PERSONID)
index<-as.numeric(freq)
fepar<-beta[1:100]#fixed effect parameter#
alpha<-rep(fepar,each=index)
nrow
nrow(alpha)
length(alpha)
alpha<-rep(fepar,index)
length(alpha)
v<- (y-alpha-beta1*x1-beta2*x2)/ s
beta<-rep(0.1,103)
ols_func <- function (beta,y=y,x1=x1,x2=x2) {
fepar<-beta[1:100]#fixed effect parameter#
beta1<-beta[101]#education coefficient#
beta2<-beta[102]#potential experience coefficient#
s<-beta[103]# standard error#
index<-as.numeric(freq)
alpha<-rep(fepar,index)
v<- (y-alpha-beta1*x1-beta2*x2)/ s
p<-dnorm(v)
lg<-log(p)
loglsum<-sum(lg)
return(-loglsum)
}  # finish the loglikeli
beta[1:102]<-rnorm(102)
beta[103]<- 1
y<-data4$LOGWAGE
x1<-data4$EDUC
x2<-data4$POTEXPER
optim(beta,ols_func,y=y,x1=x1,x2=x2)
#####start the ols regression model to find estimated indivdiual fixed effect####
reg<-lm(y~x1+x2+factor(data4$PERSONID)-1)
coefficient<-reg$coefficients
ynew<-coefficient[3:102]
data4new<-data4[!duplicated(data4$PERSONID),]
#####set up the regression of individual fixed effect on time invariant######
reg2<-lm(ynew~ABILITY+MOTHERED+FATHERED+BRKNHOME+SIBLINGS,data = data4new)
coefficientnew<-reg2$coefficients
print(coefficientnew)
modelcheck2$vcov
modelcheck3
modelcheck3$vcov
modelcheck3<-plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "fd")
modelcheck4$vov
modelcheck4<-plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "fd")
modelcheck4$vov
modelcheck4<-plm(LOGWAGE~EDUC+POTEXPER,data= dataPanel, model = "fd")
modelcheck4$vov
modelcheck4$vov
modelcheck2$vcov[EDUC,"POTEXPER"]
modelcheck2$vcov["EDUC","POTEXPER"]
modelcheck2$vcov["EDUC","EDU"]
modelcheck2$vcov
modelcheck3$vcov
modelcheck3$vcov[2:3,2:3]
modelcheck4$coefficients
modelcheck4$vov
modelcheck4$vcov
modelcheck4$vcov[2:3,2:3]
modelcheck3$vcov[2:3,2:3]
modelcheck4$vcov[2:3,2:3]
